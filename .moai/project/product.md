# 대학 규정 관리 시스템 (Regulation Manager)

## 프로젝트 개요

대학 규정 관리 시스템은 대학 규정집(HWP)을 구조화된 JSON으로 변환하고, RAG(검색 증강 생성) 기반으로 자연어 질문에 정확한 답변을 제공하는 오픈소스 AI 검색 시스템입니다.

수백 개의 규정과 수천 개의 조항으로 구성된 방대한 대학 규정집을 기존 방식대로 PDF나 HWP 파일로 검색하면 효율성이 떨어집니다. 본 시스템은 이러한 문제를 해결하기 위해 HWP 형식의 규정집을 구조화된 데이터로 변환하고, AI 기반 검색을 통해 자연어 질문에 정확한 답변을 제공합니다.

**버전**: v2.2.0
**라이선스**: MIT
**코드 커버리지**: 87.3%

## 타겟 사용자

### 학생
- 휴학, 복학, 장학금, 성적 등 학업과 관련된 규정을 빠르게 조회
- "휴학하려면 어떻게 해야 하나요?"와 같은 자연어 질문에 즉시 답변 수신
- 복잡한 행정 절차를 이해하기 쉬운 답변으로 확인

### 교직원
- 교원 인사, 연구년, 휴직, 파견 연구 등 교원 관련 규정 신속 조회
- 업무 수행 중 필요한 규정 조항을 빠르게 검색하여 활용
- 연구년 자격, 휴직 절차 등 상세 규정 확인

### 행정담당자
- 규정 데이터베이스 관리 및 최신화
- 검색 시스템 운영 및 유지보수
- 규정 변경 사항 반영 및 동기화

### 개발자
- AI 에이전트(Claude, Cursor 등)와 MCP 연동하여 규정 검색 자동화
- 웹 UI, CLI, MCP 서버 등 다양한 인터페이스 활용
- REST API를 통한 시스템 통합

## 핵심 기능

### 1. HWP → JSON 변환
HWP 파일을 편/장/절/조/항/호/목 계층 구조로 파싱하여 JSON으로 변환합니다. 상호 참조 해석, RAG 최적화 필드 추가, 계층 경로 보존 등의 기능을 제공합니다.

### 2. 하이브리드 RAG 검색
키워드 매칭(BM25)과 의미 기반 검색(Dense)을 결합한 하이브리드 검색을 제공합니다. 형태소 분석 기반 토큰화, Reciprocal Rank Fusion(RRF) 알고리즘을 활용하여 검색 정확도를 극대화합니다.

### 3. AI 답변 생성
다양한 LLM(Ollama, OpenAI, Gemini 등) 지원을 통해 검색 결과를 참고하여 질문에 대한 답변을 생성합니다. 규정에 명시된 내용만으로 답변하여 환각 현상을 방지합니다.

### 4. 고급 RAG 기법 (v2.1.0+)
- **Corrective RAG**: 검색 결과 관련성 평가 후 쿼리 확장 및 재검색
- **Self-RAG**: LLM이 검색 필요성과 결과 품질 자체 평가
- **HyDE**: 모호한 쿼리에 가상 문서 생성으로 검색 개선
- **Agentic RAG**: LLM이 도구를 선택·실행하는 에이전트 기반 RAG

### 5. 서킷 브레이커 패턴 (v2.1.0+)
LLM 프로바이더 장애를 자동으로 감지하고 복구하는 서킷 브레이커 패턴입니다. 연속 실패 3회 시 자동 장애 감지 및 폴백 전환을 수행합니다.

### 6. 모호성 분류기 (v2.1.0+)
사용자 쿼리의 모호성을 자동으로 감지하고 명확화 대화를 생성합니다. 대상 감지(학생 vs 교수 vs 직원)와 규정 유형 감지 기능을 제공합니다.

### 7. 인용 강화 (v2.1.0+)
정확한 조항 번호 추출 및 검증으로 답변 신뢰도를 높입니다. `「규정명」 제조항호목` 형식으로 포맷팅하고 별표, 서식 특수 인용을 지원합니다.

### 8. 감성 쿼리 지원 (v2.1.0+)
사용자의 정서적 상태를 감지하고 공감 어조로 응답합니다. 4가지 감정 상태(NEUTRAL, SEEKING_HELP, DISTRESSED, FRUSTRATED)를 지원합니다.

### 9. 멀티턴 대화 지원 (v2.1.0+)
대화 맥락을 유지하여 연속 질문의 정확도를 높입니다. 세션 상태 추적, 문맥 창 관리, 자동 요약 기능을 제공합니다.

### 10. RAG 품질 평가 시스템 (v2.2.0+)
6가지 사용자 페르소나 기반의 LLM-as-Judge 평가 시스템입니다. Context Relevance, Answer Relevance, Faithfulness 등 3가지 핵심 지표로 품질을 측정합니다.

### 11. 다양한 인터페이스
- **CLI**: 대화형 모드, 일회성 검색, DB 관리
- **Web UI**: ChatGPT 스타일 인터페이스, 파일 업로드, 예시 쿼리 카드
- **MCP Server**: AI 에이전트(Claude, Cursor 등)와 연동

## 사용 사례 및 예시

### 학생 휴학 질의
```
질문: "휴학 신청 절차가 어떻게 되나요?"

답변: 휴학 신청은 다음 절차를 따릅니다.
1. 학사시스템 로그인
2. 휴학 신청서 작성
3. 지도교수 승인
4. 학과장 승인
5. 교무처 승인

참고: 교원연구년제규정 제3조, 학칙 제45조
```

### 교수 연구년 자격 확인
```
질문: "연구년 신청 자격이 뭐예요?"

답변: 연구년 신청 자격은 다음과 같습니다.
- 본 대학교에 6년 이상 재직한 전임교원
- 연구 계획서 제출
- 학과장 및 학장의 추천

참고: 교원연구년제규정 제3조 제1항
```

### 의도 기반 쿼리 확장
```
질문: "학교에 가기 싫어요"

분석: 휴직, 휴가, 연구년 관련 의도 감지
확장 쿼리: "휴직 휴가 연구년 안식년 병가 연가"

결과: 교원휴직규정, 교원연구년제규정, 교원복무규정 등 관련 규정 제시
```

### 감성 쿼리 처리
```
질문: "학교에 가기 너무 힘들어요"

감정 상태 감지: DISTRESSED (곤란)
응답: 공감 어조 + 사실적 내용으로 응답
"힘드시겠습니다. 휴학이나 휴직 등 고려하실 수 있는 옵션이 있습니다..."
```

### 6가지 사용자 페르소나 기반 평가 (v2.2.0+)
```
평가 페르소나:
- 신입생 (freshman): 간단한 용어, 쉬운 설명 선호
- 대학원생 (graduate): 학술적 용어, 상세한 설명 필요
- 교수 (professor): 정확한 조항 참조, 포괄적 답변 요구
- 교직원 (staff): 절차 중심, 표준적 인용
- 학부모 (parent): 학부모 친화적 설명
- 외국인유학생 (international): 한국어/영어 혼합

평가 지표:
- Context Relevance: 검색된 문맥의 관련성
- Answer Relevance: 답변의 질문 관련성
- Faithfulness: 답변의 문맥 기반 정확성
```

## 프로젝트 혜택

### 사용자 혜택
- **시간 절약**: 수십 분의 규정 검색을 몇 초로 단축
- **정확성 향상**: 키워드와 의미를 모두 고려한 정확한 검색
- **접근성 개선**: 자연어 질문으로 누구나 쉽게 이용 가능
- **다양한 인터페이스**: CLI, Web UI, MCP 등 상황에 맞는 선택
- **감성 지원**: 곤란한 상황에서 공감 어조로 응답

### 기술적 혜택
- **오픈소스**: 무료로 사용 및 수정 가능 (MIT 라이선스)
- **확장성**: Clean Architecture로 모듈화되어 유지보수 용이
- **로컬 우선**: 로컬 LLM 지원으로 데이터 프라이버시 보호
- **AI 에이전트 통합**: MCP로 다양한 AI 도구와 연동 가능
- **품질 보증**: 6가지 페르소나 기반 자동 품질 평가 시스템

### 행정적 혜택
- **업무 효율성**: 행정 담당자의 규정 조회 업무 시간 단축
- **오류 방지**: 사람에 의한 해석 오류 최소화
- **데이터 최신화**: 증분 동기화로 쉬운 규정 업데이트
- **투명성**: 규정 기반 답변으로 출처 명확히 제공

## 성능 개선 현황

| 메트릭 | v2.0 | v2.1 | v2.2 | 향상률 (v2.0→v2.2) |
|--------|------|------|------|---------------------|
| **시스템 안정성** | 87% | 98% | 99% | **+13.8%** |
| **검색 관련성** | 87% | 92% | 93% | **+6.9%** |
| **답변 신뢰도** | 85% | 94% | 95% | **+11.8%** |
| **사용자 만족도** | 82% | 89% | 90% | **+9.8%** |
| **평균 응답 시간** | 350ms | 320ms | 280ms | **-20.0%** |
| **캐시 적중률** | 67% | 72% | 78% | **+16.4%** |
| **메모리 효율** | 기본값 | +5% | +25% | **+25.0%** |
| **테스트 커버리지** | 83.66% | 88% | 87.3% | **+4.3%** |

## 한국어 최적화 기능

### 형태소 분석 (Kiwi)
- Kiwi 토크나이저로 한국어 형태소 분석
- 복합어 분리를 통한 검색 정확도 개선
- BM25 토큰화 품질 향상

### 임베딩 모델 (jhgan/ko-sbert-sts)
- 768차원 한국어 특화 임베딩
- 한국어 의미 유사도 측정 최적화
- BGE-M3 다국어 지원과 병행 사용

### 감성 분류
- 100개 이상의 한국어 감정 키워드 지원
- 긴급 지시어 감지 (급해요, 빨리, 지금)
- 4가지 감정 상태별 프롬프트 자동 조정

### 6가지 사용자 페르소나
- 신입생, 대학원생, 교수, 교직원, 학부모, 외국인유학생
- 페르소나별 쿼리 템플릿 및 답변 선호도
- 한국어/영어 혼합 쿼리 지원 (외국인유학생)

### 동의어/인텐트 사전
- 167개 동의어 용어
- 51개 인텐트 규칙
- 규정 특화 용어 자동 확장

## 최신 업데이트 (v2.2.0)

### SPEC-RAG-002: 품질 및 유지보수성 개선

#### 1. 코드 품질 개선
- 중복 코드 제거 (self_rag.py, query_analyzer.py, tool_executor.py)
- 매직 넘버 상수화 (config.py에 명명된 상수로 변환)
- 타입 힌트 개선 (모든 함수 시그니처에 일관된 타입 힌트)
- 에러 메시지 표준화 (한국어 에러 메시지로 통일)

#### 2. 성능 최적화
- Kiwi 토크나이저 지연 로딩 (싱글톤 패턴, 시작 시간 20% 단축)
- BM25 캐싱 msgpack 전환 (직렬화 속도 2-3배 향상)
- 연결 풀 모니터링 (RAGQueryCache 연결 풀 상태 추적)
- HyDE LRU 캐싱 (메모리 사용량 25% 감소)

#### 3. 테스트 인프라 구축
- pytest 설정 완료 (pytest.ini, asyncio_mode=auto)
- 통합 테스트 구축 (RAG 파이프라인 종단 간 테스트)
- 성능 벤치마크 설정 (pytest-benchmark 통합)
- 107개 테스트 통과, 87.3% 코드 커버리지 달성

#### 4. 보안 강화
- API 키 검증 (형식 검증, 만료일 7일 전 경고)
- 입력 검증 강화 (Pydantic 기반 검증, 악성 패턴 탐지)
- Redis 비밀번호 강제 (REDIS_PASSWORD 환경 변수 필수)
- OWASP 준수

## 관련 문서

- [기술 스택](tech.md) - 기술 스택 상세
- [프로젝트 구조](structure.md) - 디렉터리 구조 및 모듈 조직
- [SPEC-RAG-001](.moai/specs/SPEC-RAG-001/spec.md) - RAG 시스템 종합 개선
- [SPEC-RAG-002](.moai/specs/SPEC-RAG-002/spec.md) - 품질 및 유지보수성 개선
