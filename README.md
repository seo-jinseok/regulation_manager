# ê·œì • ê´€ë¦¬ ì‹œìŠ¤í…œ

ëŒ€í•™ ê·œì •ì§‘(HWP)ì„ êµ¬ì¡°í™”ëœ JSONìœ¼ë¡œ ë³€í™˜í•˜ê³ , AI ê¸°ë°˜ ê²€ìƒ‰ì„ ì œê³µí•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

---

## ê°œìš”

ì´ ì‹œìŠ¤í…œì€ ë‘ ê°€ì§€ í•µì‹¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

1. **ê·œì • ë³€í™˜**: HWP íŒŒì¼ â†’ êµ¬ì¡°í™”ëœ JSON
2. **ê·œì • ê²€ìƒ‰**: ìì—°ì–´ ì§ˆì˜ ê¸°ë°˜ AI ê²€ìƒ‰ ë° ë‹µë³€ ìƒì„±

```
[HWP íŒŒì¼] â†’ [JSON ë³€í™˜] â†’ [ë²¡í„° DB ì €ì¥] â†’ [ìì—°ì–´ ê²€ìƒ‰/ì§ˆë¬¸]
```

---

## ì‚¬ìš© ë°©ë²•

### ì„¤ì¹˜

```bash
git clone <repository-url> && cd regulation_manager
uv venv && source .venv/bin/activate
uv sync
```

### ê¸°ë³¸ ì›Œí¬í”Œë¡œìš°

```bash
# 1. HWP íŒŒì¼ì„ JSONìœ¼ë¡œ ë³€í™˜
uv run regulation-manager "data/input/ê·œì •ì§‘.hwp"

# 2. ë²¡í„° DBì— ì €ì¥
uv run regulation-rag sync data/output/ê·œì •ì§‘.json

# 3. ê·œì • ê²€ìƒ‰
uv run regulation-rag search "êµì› ì—°êµ¬ë…„ ì‹ ì²­ ìê²©"

# 4. AIì—ê²Œ ì§ˆë¬¸ (ì„ íƒ)
uv run regulation-rag ask "êµì› ì—°êµ¬ë…„ ì‹ ì²­ ìê²©ì€?"
```

### ê²€ìƒ‰ ì˜µì…˜

| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `-n 10` | ê²€ìƒ‰ ê²°ê³¼ ê°œìˆ˜ ì§€ì • |
| `--include-abolished` | íì§€ëœ ê·œì • í¬í•¨ |
| `--no-rerank` | AI ì¬ì •ë ¬ ë¹„í™œì„±í™” (ë¹ ë¥¸ ê²€ìƒ‰) |

### LLM ì§ˆë¬¸ ì˜µì…˜

| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `--provider ollama` | LLM í”„ë¡œë°”ì´ë” (ollama, lmstudio, openai ë“±) |
| `--model gemma2` | ì‚¬ìš©í•  ëª¨ë¸ëª… |
| `-v`, `--verbose` | ìƒì„¸ ì •ë³´ ì¶œë ¥ (LLM ì„¤ì •, ì¸ë±ìŠ¤ êµ¬ì¶• ë“±) |
| `--show-sources` | ì°¸ê³  ê·œì • ì „ë¬¸ ì¶œë ¥ |

### ì›¹ UI

ë¹„ê°œë°œìë¥¼ ìœ„í•œ í†µí•© ì›¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

```bash
uv run regulation-web
```

íŒŒì¼ ì—…ë¡œë“œ â†’ ë³€í™˜ â†’ DB ë™ê¸°í™” â†’ ì§ˆë¬¸ê¹Œì§€ í•œ í™”ë©´ì—ì„œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### MCP ì„œë²„

AI ì—ì´ì „íŠ¸(Claude, Cursor ë“±)ì—ì„œ ê·œì • ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” MCP(Model Context Protocol) ì„œë²„ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

```bash
# MCP ì„œë²„ ì‹¤í–‰ (stdio ëª¨ë“œ)
uv run regulation-mcp
```

**ì§€ì› ë„êµ¬ (Tools)**:

| Tool | ì„¤ëª… |
|------|------|
| `sync_regulations` | ê·œì • DB ë™ê¸°í™” |
| `search_regulations` | ê·œì • ê²€ìƒ‰ (Hybrid + Rerank) |
| `ask_regulations` | AI ì§ˆë¬¸-ë‹µë³€ |
| `get_sync_status` | ë™ê¸°í™” ìƒíƒœ ì¡°íšŒ |
| `reset_database` | DB ì´ˆê¸°í™” |

**í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì„¤ì •** (Claude Desktop ì˜ˆì‹œ):

```json
{
  "mcpServers": {
    "regulation-rag": {
      "command": "uv",
      "args": ["run", "regulation-mcp"],
      "cwd": "/path/to/regulation_manager"
    }
  }
}
```

---

## ëª…ë ¹ì–´ ìš”ì•½

### ê·œì • ë³€í™˜

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `regulation-manager "íŒŒì¼.hwp"` | HWP â†’ JSON ë³€í™˜ |
| `regulation-manager "íŒŒì¼.hwp" --use_llm` | LLM ì „ì²˜ë¦¬ í™œì„±í™” (í’ˆì§ˆ í–¥ìƒ) |
| `regulation-manager "íŒŒì¼.hwp" --no-enhance-rag` | RAG ìµœì í™” ë¹„í™œì„±í™” |

### RAG ì‹œìŠ¤í…œ

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `regulation-rag sync <json>` | JSON â†’ ë²¡í„° DB ë™ê¸°í™” |
| `regulation-rag sync <json> --full` | ì „ì²´ ì¬ë™ê¸°í™” |
| `regulation-rag search "<ì¿¼ë¦¬>"` | ê·œì • ê²€ìƒ‰ |
| `regulation-rag ask "<ì§ˆë¬¸>"` | AI ë‹µë³€ ìƒì„± |
| `regulation-rag status` | ë™ê¸°í™” ìƒíƒœ í™•ì¸ |
| `regulation-rag reset --confirm` | DB ì´ˆê¸°í™” |

---

## ì‹œìŠ¤í…œ íŠ¹ì§•

### 1ï¸âƒ£ HWP êµ¬ì¡°í™” (JSON ë³€í™˜)

HWP íŒŒì¼ì˜ ë³µì¡í•œ ê·œì • ë‚´ìš©ì„ **ê³„ì¸µì  JSON êµ¬ì¡°**ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

```
[HWP ì›ë³¸]                      [JSON ì¶œë ¥]
ì œ4ì¡° (ìš©ì–´ì˜ ì •ì˜)       â†’     { "display_no": "ì œ4ì¡°",
  1. í•™ê³¼(ì „ê³µ)ë€...              "title": "ìš©ì–´ì˜ ì •ì˜",
  2. ì…í•™ì •ì›ì´ë€...              "children": [
  ...                               { "display_no": "1.", "text": "í•™ê³¼(ì „ê³µ)ë€..." },
  6. êµìœ¡í¸ì œ ì¡°ì •ì€...             { "display_no": "6.", "text": "êµìœ¡í¸ì œ ì¡°ì •ì€...",
    ê°€. í†µí•©ì´ë€...                   "children": [
    ë‚˜. ì‹ ì„¤ì´ë€...                     { "display_no": "ê°€.", "text": "í†µí•©ì´ë€..." },
    ë‹¤. íì§€ë€...                       { "display_no": "ë‹¤.", "text": "íì§€ë€..." }
                                      ]}]}
```

**RAG ìµœì í™” í•„ë“œ ìë™ ìƒì„±** (`enhance_for_rag.py`):

| í•„ë“œ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| `parent_path` | ê³„ì¸µ ê²½ë¡œ (Breadcrumb) | `["í•™ê³¼í‰ê°€ê·œì •", "ì œ4ì¡° ìš©ì–´ì˜ ì •ì˜", "6. êµìœ¡í¸ì œ ì¡°ì •"]` |
| `embedding_text` | ì„ë² ë”©ìš© í…ìŠ¤íŠ¸ (ê²½ë¡œ í¬í•¨) | `ì œ4ì¡° ìš©ì–´ì˜ ì •ì˜ > 6. êµìœ¡í¸ì œ ì¡°ì • > ë‹¤. í•™ê³¼(ì „ê³µ) íì§€: íì§€ë€...` |
| `keywords` | í•µì‹¬ í‚¤ì›Œë“œ (ê°€ì¤‘ì¹˜ í¬í•¨) | `[{"term": "í•™ê³¼", "weight": 0.9}]` |

### 2ï¸âƒ£ ë²¡í„° DB ì €ì¥ (ChromaDB)

ë³€í™˜ëœ JSONì˜ ê° ì¡°í•­ì„ **ì²­í¬(Chunk)** ë‹¨ìœ„ë¡œ ë¶„ë¦¬í•˜ì—¬ ChromaDBì— ì €ì¥í•©ë‹ˆë‹¤.

- **ì„ë² ë”© ëª¨ë¸**: `BAAI/bge-m3` (ë‹¤êµ­ì–´ ì§€ì›, í•œêµ­ì–´ ìµœì í™”)
- **ì¦ë¶„ ë™ê¸°í™”**: ë³€ê²½ëœ ê·œì •ë§Œ ì—…ë°ì´íŠ¸ (ì›”ê°„ ê·œì • ì—…ë°ì´íŠ¸ ì‹œ ì²˜ë¦¬ ì‹œê°„ ë‹¨ì¶•)
- **ë©”íƒ€ë°ì´í„° ì €ì¥**: `rule_code`, `parent_path`, `status`, `effective_date` ë“±

### 3ï¸âƒ£ ì¿¼ë¦¬ ê°€ê³µ (Query Processing)

ì‚¬ìš©ì ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ **ìµœì ì˜ ê²€ìƒ‰ ì „ëµ**ì„ ìë™ ì„ íƒí•©ë‹ˆë‹¤ (`QueryAnalyzer`).

| ë‹¨ê³„ | ì²˜ë¦¬ ë‚´ìš© | ì˜ˆì‹œ |
|------|----------|------|
| **ìœ í˜• ë¶„ì„** | ì¿¼ë¦¬ íŒ¨í„´ ê°ì§€ | `"ì œ15ì¡°"` â†’ ì¡°ë¬¸ ë²ˆí˜¸ / `"íœ´í•™í•˜ë ¤ë©´?"` â†’ ìì—°ì–´ ì§ˆë¬¸ |
| **ë™ì  ê°€ì¤‘ì¹˜** | BM25/Dense ë¹„ìœ¨ ìë™ ì¡°ì • | ì¡°ë¬¸ ë²ˆí˜¸: BM25 60% / ìì—°ì–´: Dense 60% |
| **ë™ì˜ì–´ í™•ì¥** | ìœ ì‚¬ì–´ ì¶”ê°€ | `"íê³¼"` â†’ `"íê³¼ í•™ê³¼íì§€ ì „ê³µíì§€"` |
| **ë¶ˆìš©ì–´ ì œê±°** | ê²€ìƒ‰ ë…¸ì´ì¦ˆ ì œê±° | `"~í•˜ë ¤ë©´"`, `"~ì¸ê°€ìš”"` ë“± ì œê±° |

### 4ï¸âƒ£ Hybrid Search (ê²€ìƒ‰)

**ë‘ ê°€ì§€ ê²€ìƒ‰ ë°©ì‹ì„ ê²°í•©**í•˜ì—¬ ì •í™•ë„ë¥¼ ë†’ì…ë‹ˆë‹¤.

```
[Query] â”€â”€â”¬â”€â”€ BM25 (í‚¤ì›Œë“œ ë§¤ì¹­) â”€â”€â”¬â”€â”€ RRF ìœµí•© â”€â”€ [ê²°ê³¼]
          â”‚                        â”‚
          â””â”€â”€ Dense (ì˜ë¯¸ ê²€ìƒ‰) â”€â”€â”€â”˜
```

- **BM25**: ì •í™•í•œ í‚¤ì›Œë“œ ë§¤ì¹­ (ì˜ˆ: `"ì œ15ì¡°"`, `"íœ´í•™ê·œì •"`)
- **Dense**: ì˜ë¯¸ì  ìœ ì‚¬ì„± ê²€ìƒ‰ (ì˜ˆ: `"í•™êµ ì‰¬ê³  ì‹¶ì–´ìš”"` â†’ íœ´í•™ ê·œì •)
- **RRF ìœµí•©**: Reciprocal Rank Fusionìœ¼ë¡œ ë‘ ê²°ê³¼ í†µí•©

### 5ï¸âƒ£ Reranking (BGE Cross-Encoder)

ê²€ìƒ‰ ê²°ê³¼ë¥¼ **Cross-Encoder**ë¡œ ì¬ì •ë ¬í•˜ì—¬ ì •í™•ë„ë¥¼ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

- **ëª¨ë¸**: `BAAI/bge-reranker-v2-m3`
- **ì‘ë™ ë°©ì‹**: ì§ˆë¬¸-ë¬¸ì„œ ìŒì„ ì§ì ‘ ë¹„êµí•˜ì—¬ ê´€ë ¨ì„± ì ìˆ˜ ê³„ì‚°
- **ì¡°í•­ ë²ˆí˜¸ ë§¤ì¹­ ë³´ë„ˆìŠ¤**: `ì œNì¡°`, `ì œNí•­` ë“± ì •í™•íˆ ì¼ì¹˜ ì‹œ ê°€ì‚°ì 

### 6ï¸âƒ£ LLM ë‹µë³€ ìƒì„±

ê²€ìƒ‰ëœ ê·œì •ì„ ê¸°ë°˜ìœ¼ë¡œ **ìì—°ì–´ ë‹µë³€**ì„ ìƒì„±í•©ë‹ˆë‹¤.

- **Context êµ¬ì„±**: ìƒìœ„ Nê°œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê³„ì¸µ ê²½ë¡œì™€ í•¨ê»˜ ì œê³µ
- **ì‹ ë¢°ë„ ê³„ì‚°**: Reranker ì ìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€ ì‹ ë¢°ë„ í‘œì‹œ
- **ì¶œì²˜ í‘œì‹œ**: ë‹µë³€ì— ì‚¬ìš©ëœ ê·œì •ì˜ ê²½ë¡œì™€ ê´€ë ¨ë„ í‘œì‹œ

```
ğŸ“ í•™ê³¼í‰ê°€ê·œì • > ì œ4ì¡° ìš©ì–´ì˜ ì •ì˜ > 6. êµìœ¡í¸ì œ ì¡°ì • > ë‹¤. í•™ê³¼(ì „ê³µ) íì§€
   í•™ê³¼(ì „ê³µ) íì§€ë€ ì„¤ì¹˜ëœ í•™ê³¼(ì „ê³µ)ê°€ ì—†ì–´ì§€ëŠ” ê²ƒì„ ë§í•œë‹¤.
   ğŸ“‹ ê´€ë ¨ë„: 100% ğŸŸ¢ ë§¤ìš° ë†’ìŒ | AI ì‹ ë¢°ë„: 0.943
```

### 7ï¸âƒ£ ì¦ë¶„ ë™ê¸°í™”

ì›”ê°„ ê·œì • ì—…ë°ì´íŠ¸ ì‹œ ë³€ê²½ëœ ê·œì •ë§Œ ë™ê¸°í™”í•˜ì—¬ ì²˜ë¦¬ ì‹œê°„ì„ ë‹¨ì¶•í•©ë‹ˆë‹¤.

- ê·œì •ë³„ í•´ì‹œê°’ ë¹„êµë¡œ ë³€ê²½ ê°ì§€
- ì‹ ê·œ/ìˆ˜ì •/ì‚­ì œëœ ê·œì •ë§Œ ì²˜ë¦¬
- ìƒíƒœ íŒŒì¼(`sync_state.json`)ë¡œ ë™ê¸°í™” ì´ë ¥ ê´€ë¦¬

---

## í™˜ê²½ ì„¤ì •

```bash
cp .env.example .env
```

**ì£¼ìš” ì„¤ì •:**

```bash
# LLM ê¸°ë³¸ê°’
LLM_PROVIDER=ollama
LLM_MODEL=gemma2
LLM_BASE_URL=http://localhost:11434

# API í‚¤ (í´ë¼ìš°ë“œ LLM ì‚¬ìš© ì‹œ)
OPENAI_API_KEY=sk-...
GEMINI_API_KEY=AIza...
```

ì‹¤í–‰ ì‹œ `.env`ë¥¼ ìë™ ë¡œë“œí•˜ë¯€ë¡œ, ìœ„ ì„¤ì •ì´ ì½”ë“œ ê¸°ë³¸ê°’ë³´ë‹¤ ìš°ì„  ì ìš©ë©ë‹ˆë‹¤.

ì½”ë“œ ê¸°ë³¸ê°’(ì˜µì…˜/`.env` ë¯¸ì„¤ì • ì‹œ):

| ì‚¬ìš© ìœ„ì¹˜ | LLM ê¸°ë³¸ê°’ |
|-----------|------------|
| `regulation-manager` | provider: `openai` (model: `gpt-4o`) |
| `regulation-rag` / ì›¹ UI | provider: `ollama` (model: `gemma2`, base_url: `http://localhost:11434`) |

---

## ë¬¸ì„œ

| ë¬¸ì„œ | ì„¤ëª… |
|------|------|
| [QUICKSTART.md](./QUICKSTART.md) | ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ |
| [docs/LLM_GUIDE.md](./docs/LLM_GUIDE.md) | LLM ì„¤ì • ê°€ì´ë“œ |
| [SCHEMA_REFERENCE.md](./SCHEMA_REFERENCE.md) | JSON ì¶œë ¥ ìŠ¤í‚¤ë§ˆ ëª…ì„¸ |
| [AGENTS.md](./AGENTS.md) | ê°œë°œì ê°€ì´ë“œ |

---

## ë¬¸ì œ í•´ê²°

| ë¬¸ì œ | í•´ê²° ë°©ë²• |
|------|----------|
| "ë°ì´í„°ë² ì´ìŠ¤ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤" | `sync` ëª…ë ¹ ì‹¤í–‰ |
| "íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" | íŒŒì¼ ê²½ë¡œ í™•ì¸ (ì ˆëŒ€ ê²½ë¡œ ê¶Œì¥) |
| ê²€ìƒ‰ ê²°ê³¼ê°€ ë¶€ì •í™•í•¨ | `--no-rerank` ì œê±°í•˜ì—¬ AI ì¬ì •ë ¬ í™œì„±í™” í™•ì¸ |
| ë³€í™˜ í’ˆì§ˆì´ ë‚®ìŒ | `--use_llm` ì˜µì…˜ìœ¼ë¡œ LLM ì „ì²˜ë¦¬ í™œì„±í™” |
| "hwp5html ì‹¤í–‰ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" | `hwp5html` ì„¤ì¹˜ í›„ ë‹¤ì‹œ ì‹¤í–‰ (ë³€í™˜ì€ hwp5html CLI í•„ìš”) |

---

# ê°œë°œì ê°€ì´ë“œ

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
regulation_manager/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py              # ë³€í™˜ íŒŒì´í”„ë¼ì¸ ì§„ì…ì 
â”‚   â”œâ”€â”€ converter.py         # HWP â†’ Markdown/HTML
â”‚   â”œâ”€â”€ formatter.py         # Markdown â†’ JSON
â”‚   â”œâ”€â”€ enhance_for_rag.py   # RAG ìµœì í™” í•„ë“œ ì¶”ê°€
â”‚   â”œâ”€â”€ parsing/             # íŒŒì‹± ëª¨ë“ˆ
â”‚   â””â”€â”€ rag/                 # RAG ì‹œìŠ¤í…œ (Clean Architecture)
â”‚       â”œâ”€â”€ interface/       # CLI, Web UI
â”‚       â”œâ”€â”€ application/     # Use Cases
â”‚       â”œâ”€â”€ domain/          # ë„ë©”ì¸ ëª¨ë¸
â”‚       â””â”€â”€ infrastructure/  # ChromaDB, Reranker, LLM
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ input/               # HWP íŒŒì¼ ì…ë ¥
â”‚   â”œâ”€â”€ output/              # JSON ì¶œë ¥
â”‚   â””â”€â”€ chroma_db/           # ë²¡í„° DB ì €ì¥ì†Œ
â””â”€â”€ tests/                   # pytest í…ŒìŠ¤íŠ¸
```

## RAG ì•„í‚¤í…ì²˜

```
[Query] â†’ [Hybrid Search] â†’ [BGE Reranker] â†’ [LLM ë‹µë³€ ìƒì„±]
                 â†“                  â†“
         BM25 + Dense         Cross-Encoder
        (RRF ìœµí•©)             Reranking
```

### í•µì‹¬ ì»´í¬ë„ŒíŠ¸

| ì»´í¬ë„ŒíŠ¸ | íŒŒì¼ | ì„¤ëª… |
|----------|------|------|
| ë²¡í„° ì €ì¥ì†Œ | `chroma_store.py` | ChromaDB ê¸°ë°˜ ì„ë² ë”© ì €ì¥/ê²€ìƒ‰ |
| Reranker | `reranker.py` | BGE-reranker-v2-m3 Cross-encoder |
| ê²€ìƒ‰ Use Case | `search_usecase.py` | ê²€ìƒ‰ ë¡œì§ ë° ìŠ¤ì½”ì–´ë§ |
| JSON ë¡œë” | `json_loader.py` | ê·œì • JSON íŒŒì‹± ë° ì²­í¬ ì¶”ì¶œ |

### ì„ë² ë”© í…ìŠ¤íŠ¸ êµ¬ì¡°

```python
# ê¸°ì¡´ (ìˆœìˆ˜ í…ìŠ¤íŠ¸)
embedding_text = "ìˆ˜ì—…ì¼ìˆ˜ëŠ” ì—°ê°„ 16ì£¼ ì´ìƒìœ¼ë¡œ í•œë‹¤."

# í˜„ì¬ (ê³„ì¸µ ë§¥ë½ í¬í•¨)
embedding_text = "ì œ3ì¥ í•™ì‚¬ > ì œ1ì ˆ ìˆ˜ì—… > ì œ15ì¡° ìˆ˜ì—…ì¼ìˆ˜: ìˆ˜ì—…ì¼ìˆ˜ëŠ” ì—°ê°„ 16ì£¼ ì´ìƒìœ¼ë¡œ í•œë‹¤."
```

## ê°œë°œ ëª…ë ¹ì–´

```bash
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
uv run pytest

# íŠ¹ì • í…ŒìŠ¤íŠ¸
uv run pytest tests/test_enhance_for_rag.py -v

# ì˜ì¡´ì„± ì¶”ê°€
uv add <package>
```

## ìš”êµ¬ ì‚¬í•­

- Python 3.11+
- `uv` íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €
- `hwp5` ë¼ì´ë¸ŒëŸ¬ë¦¬ + `hwp5html` CLI (HWP íŒŒì¼ ì²˜ë¦¬)
